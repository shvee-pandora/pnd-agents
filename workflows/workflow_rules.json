{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "PND Agents Workflow Rules Configuration",
  "version": "3.0.0",
  "workflows": {
    "figma": ["figma", "frontend", "unit_test", "review", "sonar", "performance"],
    "frontend": ["frontend", "unit_test", "review", "sonar", "performance"],
    "backend": ["backend", "unit_test", "review", "sonar"],
    "amplience": ["amplience", "frontend", "unit_test", "review", "sonar"],
    "amplience_placement": ["amplience_placement"],
    "qa": ["unit_test", "review", "sonar"],
    "unit_test": ["unit_test", "sonar"],
    "test_case_writing": ["test_case_writing", "qa"],
    "sonar": ["sonar", "review"],
    "code_review": ["review", "sonar"],
    "performance": ["performance", "frontend", "unit_test", "review"],
    "technical_debt": ["technical_debt"],
    "default": ["frontend", "unit_test", "review", "sonar"]
  },
  "parallel_groups": {
    "figma": [["figma"], ["frontend"], ["unit_test", "performance"], ["review"], ["sonar"]],
    "frontend": [["frontend"], ["unit_test", "performance"], ["review"], ["sonar"]],
    "backend": [["backend"], ["unit_test"], ["review"], ["sonar"]],
    "amplience": [["amplience"], ["frontend"], ["unit_test"], ["review"], ["sonar"]],
    "amplience_placement": [["amplience_placement"]],
    "qa": [["unit_test"], ["review"], ["sonar"]],
    "unit_test": [["unit_test"], ["sonar"]],
    "test_case_writing": [["test_case_writing"], ["qa"]],
    "sonar": [["sonar"], ["review"]],
    "code_review": [["review"], ["sonar"]],
    "performance": [["performance"], ["frontend"], ["unit_test"], ["review"]],
    "technical_debt": [["technical_debt"]],
    "default": [["frontend"], ["unit_test"], ["review"], ["sonar"]]
  },
  "keywords": {
    "figma": [
      "figma",
      "design",
      "frame",
      "component",
      "ui spec",
      "figma.com",
      "from design",
      "design file"
    ],
    "frontend": [
      "react",
      "component",
      "tsx",
      "ui",
      "frontend",
      "next.js",
      "nextjs",
      "jsx",
      "styled",
      "css"
    ],
    "backend": [
      "api",
      "endpoint",
      "server",
      "route",
      "integration",
      "backend",
      "rest",
      "graphql",
      "database"
    ],
    "amplience": [
      "content type",
      "cms",
      "schema",
      "amplience",
      "content model",
      "dynamic content"
    ],
    "amplience_placement": [
      "placement",
      "place modules",
      "figma to amplience",
      "design to cms",
      "slot placement",
      "module placement",
      "cms placement",
      "amplience placement",
      "map figma",
      "map design"
    ],
    "qa": [
      "tests",
      "automation",
      "playwright",
      "testing",
      "test cases",
      "e2e",
      "integration tests"
    ],
    "unit_test": [
      "unit tests",
      "unit test",
      "coverage",
      "jest",
      "vitest",
      "100% coverage",
      "test coverage",
      "write tests"
    ],
    "test_case_writing": [
      "test cases",
      "test case",
      "test plan",
      "test scenarios",
      "test documentation",
      "qa documentation",
      "acceptance criteria",
      "gherkin",
      "bdd",
      "test specification"
    ],
    "sonar": [
      "sonar",
      "sonarcloud",
      "sonarqube",
      "code quality",
      "quality gate",
      "duplication",
      "code smells",
      "vulnerabilities",
      "security hotspot"
    ],
    "code_review": [
      "review",
      "lint",
      "standards",
      "refactor",
      "code quality",
      "eslint",
      "prettier"
    ],
    "performance": [
      "har",
      "performance",
      "optimize",
      "slow",
      "lighthouse",
      "web vitals",
      "speed"
    ],
    "technical_debt": [
      "technical debt",
      "tech debt",
      "debt analysis",
      "debt register",
      "todo comments",
      "fixme",
      "deprecated",
      "complexity",
      "code quality",
      "maintainability",
      "refactoring needed",
      "legacy code"
    ]
  },
  "agents": {
    "figma": {
      "name": "Figma Parser Agent",
      "description": "Extract component structure from Figma design",
      "handler": "figma_reader_agent.run",
      "input": ["figma_url", "node_id"],
      "output": ["component", "design_tokens", "assets", "variants"]
    },
    "frontend": {
      "name": "Frontend Engineer Agent",
      "description": "Generate React components",
      "handler": "frontend_agent.create_component",
      "input": ["component_spec", "design_tokens"],
      "output": ["files", "imports", "styles"]
    },
    "backend": {
      "name": "Backend Agent",
      "description": "Create API endpoints and server components",
      "handler": "backend_agent.create_endpoint",
      "input": ["endpoint_spec"],
      "output": ["route_file", "schema"]
    },
    "amplience": {
      "name": "Amplience CMS Agent",
      "description": "Generate Amplience content type schemas",
      "handler": "amplience_agent.generate_schema",
      "input": ["content_type_name", "fields"],
      "output": ["schema", "example_payload"]
    },
    "review": {
      "name": "Code Review Agent",
      "description": "Validate code against standards",
      "handler": "code_review_agent.run_review",
      "input": ["files"],
      "output": ["issues", "suggestions", "passed"]
    },
    "qa": {
      "name": "QA Agent",
      "description": "Validate implementation against test cases and acceptance criteria. Gets test cases from user or previous workflow stages.",
      "handler": "qa_agent.run",
      "input": ["test_cases", "code_paths", "acceptance_criteria", "previous_output"],
      "output": ["validation_status", "scenarios", "pass_rate", "issues_found", "recommendations"]
    },
    "performance": {
      "name": "Performance Agent",
      "description": "Run performance analysis and optimization checks",
      "handler": "performance_agent.analyze",
      "input": ["files", "har_file"],
      "output": ["recommendations", "score"]
    },
    "unit_test": {
      "name": "Unit Test Agent",
      "description": "Generate comprehensive unit tests with 100% coverage target",
      "handler": "unit_test_agent.run",
      "input": ["files", "component_spec"],
      "output": ["test_files", "test_cases", "coverage_report", "recommendations"]
    },
    "sonar": {
      "name": "Sonar Validation Agent",
      "description": "Validate code against SonarCloud quality gates (0 errors, 0 duplication, 100% coverage)",
      "handler": "sonar_validation_agent.run",
      "input": ["branch", "repo_path"],
      "output": ["issues", "fix_plans", "coverage", "pr_checklist", "quality_gate_status"]
    },
    "amplience_placement": {
      "name": "Amplience Placement Agent",
      "description": "Human-in-the-Loop agent that maps Figma designs to Amplience CMS modules with mandatory human approval before any write operations",
      "handler": "amplience_placement_agent.run",
      "input": ["figma_url", "figma_file_id", "figma_node_id", "approval_status", "approved_by"],
      "output": ["placement_plan", "mappings", "confidence_scores", "review_summary", "draft_ids"]
    },
    "technical_debt": {
      "name": "Technical Debt Agent",
      "description": "READ-ONLY agent that identifies, classifies, and prioritizes technical debt across a repository using static analysis and optional SonarCloud integration",
      "handler": "technical_debt_agent.run",
      "input": ["repo_path", "include_sonarcloud", "sonar_project_key", "sonar_branch"],
      "output": ["report", "summary", "register", "hotspots", "recommendations", "next_actions"]
    },
    "test_case_writing": {
      "name": "Test Case Writing Agent",
      "description": "Generate comprehensive test cases from requirements, user stories, or acceptance criteria",
      "handler": "test_case_writing_agent.run",
      "input": ["requirements", "feature_name", "acceptance_criteria", "include_security", "include_accessibility"],
      "output": ["test_suites", "test_cases", "coverage_summary", "recommendations"]
    }
  },
  "defaults": {
    "continueOnError": false,
    "maxRetries": 2,
    "timeout": 300000,
    "contextFile": "/tmp/pnd_agent_context.json"
  }
}
